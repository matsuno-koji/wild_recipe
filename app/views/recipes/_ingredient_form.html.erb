<div class="ingredient-form">
  <div class="ingredients-show">
    <% if @recipe.ingredient.empty? %>
      <p>材料を入力しましょう</p>
    <% else %>
      <%= render "ingredients_show" %>
    <% end %>
  </div>
  
  <dt class="pr10"><a>材料を変更する</a></dt>
  <dd>
    <%= form_with model: @ingredients, url: ingredients_path do |form| %>
      <%= hidden_field_tag :recipe_id, @recipe.id %>
      
      <% @ingredients.collection.each_with_index do |ingredient, i| %>
        <% existing_ingredient = @recipe.ingredient.find_by(number: "#{i+1}") %>
        <%= fields_for 'ingredients[]', ingredient do |field| %>
          
          <% if existing_ingredient && existing_ingredient.name.present? %>
            <%= field.text_field :name, value: existing_ingredient.name %>
            <%= field.text_field :amount, value: existing_ingredient.amount %>
          <% else %>
            <%= field.text_field :name, placeholder: "材料名" %>
            <%= field.text_field :amount, placeholder: "量" %>
          <% end %>
          
        <% end %>
      <% end %>
      <%= form.submit %>
    <% end %>
   
  </dd>
</div>
