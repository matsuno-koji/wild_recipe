<h1><%= @recipe.name %></h1>
<h3>材料</h3>
<% if @recipe.ingredient.empty? %>
  <p>材料を入力しましょう</p>
<% else %>
  <% @recipe.ingredient.each do |ingredient| %>
    <% if ingredient.name.present? %>
      <p><%= ingredient.number %>…<%= ingredient.name %>:<%= ingredient.amount %></p>
    <% end %>
  <% end %>
<% end %>

<%= form_with model: @ingredients, url: ingredients_path, local: true do |form| %>
  <%= hidden_field_tag :recipe_id, @recipe.id %>
  <% @ingredients.collection.each_with_index do |ingredient, i| %>
    <%= fields_for 'ingredients[]', ingredient do |field| %>
      <% if @recipe.ingredient.find_by(number: "#{(i+1)}") && @recipe.ingredient.find_by(number: "#{(i+1)}").name.present? %>
        <%= field.text_field :name, value: @recipe.ingredient.find_by(number: "#{(i+1)}").name %>
        <%= field.text_field :amount, value: @recipe.ingredient.find_by(number: "#{(i+1)}").amount %>
      <% else %>
        <%= field.text_field :name, placeholder: "材料名" %>
        <%= field.text_field :amount, placeholder: "量" %>
      <% end %>
    <% end %>
  <% end %>
  <%= form.submit %>
<% end %>

<h3>調理の手順</h3>
<% if @recipe.procedure.empty? %>
  <p>手順を入力しましょう</p>
<% else %>
  <% @recipe.procedure.each do |procedure| %>
    <% if procedure.content.present? %>
      <p><%= procedure.number %>…<%= procedure.content %></p>
    <% end %>
  <% end %>
<% end %>

<% 5.times.with_index do |i| %>
  <%= form_for(@procedure) do |form| %>
    <%= hidden_field_tag :recipe_id, @recipe.id %>
    <% if @recipe.procedure.find_by(number: "#{(i+1)}") && @recipe.procedure.find_by(number: "#{(i+1)}").content.present? %>
      <%= "#{(i+1)}" %>:<%= form.text_field :content , value: @recipe.procedure.find_by(number: "#{(i+1)}").content %>
    <% else %>
      <%= "#{(i+1)}"%>:<%= form.text_field :content %>
    <% end %>
    <%= form.hidden_field :number, value: "#{(i+1)}" %>
    <%= form.submit "保存" %>
  <% end %>
<% end %>